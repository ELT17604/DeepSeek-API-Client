# DeepSeek API Client GUI 用户说明书

## 概述

DeepSeek API Client GUI v0.7.2 是一个基于 Python Tkinter 的图形界面应用程序，用于与 DeepSeek API 进行交互。支持模型选择、聊天对话、余额查询等功能，并提供实时状态监控和 Markdown 渲染。

## 系统要求

- Python 3.7+
- 必需依赖：`tkinter`、`requests`、`openai`
- 可选依赖：`cryptography`（用于 API Key 加密存储）

## 启动方式

```bash
# GUI 模式（默认）
python main-single.py
python main-single.py --gui

# CLI 模式
python main-single.py --cli
```

## 主要功能

### 1. API Key 管理

- **输入**：在 API Key 输入框中输入您的 DeepSeek API Key
- **加密存储**：支持将 API Key 加密保存到本地文件，下次启动时自动加载
- **安全性**：使用基于机器特定信息的加密密钥，确保 API Key 安全
- **清除功能**：支持清除已保存的 API Key 并重置客户端状态

### 2. 模型选择

- **自动获取**：初始化客户端后自动获取可用模型列表
- **下拉选择**：通过下拉菜单选择模型，支持实时搜索
- **智能过滤**：优先显示聊天和编程相关模型
- **手动刷新**：点击"Refresh Models"按钮手动刷新模型列表

### 3. 聊天功能

- **流式输出**：实时显示 AI 回复内容
- **Markdown 渲染**：支持富文本格式显示，包括代码块、标题、列表等
- **会话管理**：支持新建会话、结束聊天
- **输入控制**：Enter 发送，Ctrl+Enter 换行，Shift+Enter 换行
- **停止功能**：可中途停止 AI 生成
- **字体调节**：支持调节输出区域字体大小（8-24像素）

### 4. 状态监控

- **主界面指示灯**：两个彩色指示灯显示整体状态和聊天状态
- **独立监控窗口**：详细显示五个维度的状态信息
- **实时更新**：网络状态每30秒自动检测，包含延迟信息

## 状态指示灯详细说明

### 主界面指示灯

#### 左侧指示灯（综合状态）

- 🟢 **绿色**：客户端、网络、模型、HTTP 四项状态均为绿色
- 🟡 **黄色**：网络为黄色但其他三项为绿色，或模型未选择但其他为绿色
- 🔴 **红色**：存在一个或多个关键问题

#### 右侧指示灯（聊天状态）

- 🟢 **绿色**：聊天已准备就绪，可以发送消息
- 🟡 **黄色**：正在流式输出 AI 回复
- 🔴 **红色**：聊天未就绪（客户端未初始化或模型未选择）

### 状态监控窗口详细状态

#### Client（客户端状态）

| 颜色 | 状态文本 | 说明 |
|------|----------|------|
| 🔴 红色 | No API Key | 未输入 API Key |
| 🟡 黄色 | API Key entered | 已输入 API Key 但未初始化 |
| 🟢 绿色 | Initialized | 客户端已成功初始化 |

#### Network（网络状态）

| 颜色 | 状态文本 | 说明 |
|------|----------|------|
| ⚪ 灰色 | Checking... | 正在检测网络状态 |
| 🟢 绿色 | Connected (< 200ms) | 网络延迟低，连接良好 |
| 🟡 黄色 | Connected (200-500ms) | 网络延迟较高 |
| 🔴 红色 | Connected (> 500ms) | 网络延迟很高 |
| 🔴 红色 | Timeout | 连接超时 |
| 🔴 红色 | Disconnected | 无法连接到 DeepSeek 服务器 |

#### Model（模型状态）

| 颜色 | 状态文本 | 说明 |
|------|----------|------|
| 🔴 红色 | Not selected | 未选择模型 |
| 🔴 红色 | Not available | 模型不可用（客户端未初始化） |
| 🔴 红色 | Available (none selected) | 有可用模型但未选择 |
| 🟡 黄色 | Failed to fetch | 获取模型列表失败 |
| 🟢 绿色 | Selected: [模型名] | 已选择模型 |

#### HTTP（HTTP 状态）

| 颜色 | 状态文本 | 说明 |
|------|----------|------|
| 🟢 绿色 | OK | HTTP 请求正常 |
| 🟢 绿色 | OK (200) | HTTP 成功状态码 |
| 🔴 红色 | Client Error (4xx) | 客户端错误（如 API Key 错误） |
| 🟡 黄色 | Server Error (5xx) | 服务器错误 |
| 🔴 红色 | Network Error | 网络错误 |

#### Chat（聊天状态）

| 颜色 | 状态文本 | 说明 |
|------|----------|------|
| 🔴 红色 | Not ready | 聊天未就绪 |
| 🟢 绿色 | Ready | 聊天已就绪，可以发送消息 |
| 🟡 黄色 | Chatting | 正在进行对话 |
| 🟡 黄色 | Streaming | 正在接收 AI 流式回复 |

## 新功能特性

### Markdown 渲染支持

- **富文本显示**：自动渲染 Markdown 格式的输出
- **代码高亮**：支持代码块和内联代码的特殊显示
- **格式化文本**：支持标题、列表、引用、粗体、斜体等格式
- **切换模式**：可在 Markdown 渲染和纯文本模式间切换

### 字体大小调节

- **灵活调节**：支持 8-24 像素字体大小范围
- **多种方式**：通过 ±按钮或直接输入数字调节
- **实时生效**：字体大小变化立即应用到输出区域

### 改进的状态监控

- **独立窗口**：状态监控窗口可独立显示，始终置顶
- **实时更新**：网络状态每30秒自动检测并显示延迟
- **详细信息**：每个状态都有详细的文本描述和颜色指示

## 使用流程

### 首次使用

1. 启动程序
2. 在 API Key 输入框中输入您的 DeepSeek API Key
3. 点击"Initialize"按钮初始化客户端
4. 等待模型列表自动加载
5. 在下拉菜单中选择模型
6. 点击"Start Chat"开始聊天

### 日常使用

1. 启动程序（如果之前保存了 API Key，会自动加载）
2. 点击"Initialize"按钮
3. 选择模型
4. 开始聊天

## 快捷键

- **Enter**：发送消息
- **Ctrl+Enter**：在输入框中换行
- **Shift+Enter**：在输入框中换行
- **字体大小调节**：使用 ± 按钮或直接输入数字

## 按钮功能

### 主要操作

- **Initialize**：初始化 API 客户端
- **Refresh Models**：刷新可用模型列表
- **Query Balance**：查询账户余额
- **Start Chat**：开始聊天会话

### 聊天控制

- **Send**：发送当前输入的消息
- **Stop**：停止当前的 AI 生成
- **New Session**：开始新的聊天会话
- **End Chat**：结束当前聊天

### 界面功能

- **Clear Output**：清空输出区域
- **Markdown: ON/OFF**：切换 Markdown 渲染模式
- **Status Monitor**：打开/关闭状态监控窗口
- **Clear API Key**：清除保存的 API Key

### 字体控制

- **－**：减小字体大小
- **＋**：增大字体大小
- **数字输入框**：直接设置字体大小

## 注意事项

- **API Key 安全**：程序使用加密方式存储 API Key，基于机器特定信息生成密钥
- **网络要求**：需要稳定的网络连接访问 DeepSeek API，支持延迟监控
- **模型选择**：不同模型有不同的能力和计费标准
- **会话管理**：长时间对话可能消耗更多 Token
- **Markdown 渲染**：复杂格式可能影响显示性能，可切换至纯文本模式

## 故障排除

### 常见问题

- **无法初始化客户端**：检查 API Key 是否正确，观察 Client 状态指示灯
- **网络连接失败**：检查网络连接和防火墙设置，观察 Network 状态延迟信息
- **模型列表为空**：检查 API Key 权限和网络连接，观察 Model 状态
- **聊天无响应**：检查模型选择和网络状态，观察 HTTP 和 Chat 状态

### 状态指示灯诊断

1. **打开状态监控窗口**：点击"Status Monitor"按钮查看详细状态
2. **观察主界面指示灯**：
   - 左侧综合状态灯显示总体健康度
   - 右侧聊天状态灯显示当前聊天状态
3. **根据颜色判断问题**：
   - **红色**：需要立即处理的问题
   - **黄色**：需要注意的警告或临时状态
   - **绿色**：状态正常
   - **灰色**：正在检测或未知状态

### 性能优化建议

- **大量输出时**：如果输出内容很多，可关闭 Markdown 渲染以提升性能
- **网络较慢时**：观察网络延迟指示，必要时检查网络环境
- **字体显示问题**：如果字体显示异常，尝试调节字体大小或重启程序

## 版本信息

**DeepSeek API Client GUI v0.7.2** © 2025 ELT Group  
Licensed under GNU General Public License v3.0  
Email: elt17604@outlook.com

### 版本更新说明

#### v0.7.2 新增功能

- 完整的状态监控系统，包含五个维度的状态指示
- 独立状态监控窗口，实时显示详细状态信息
- 网络延迟实时监控，每30秒自动检测
- Markdown 渲染支持，包括代码块、标题、列表等格式
- 字体大小调节功能，支持8-24像素范围
- 改进的 API Key 管理，支持清除功能
- 流式输出停止功能
- 多种输入方式支持（Enter、Ctrl+Enter、Shift+Enter）
- 客户端状态逻辑优化：区分未输入API Key、已输入但未初始化、已初始化三种状态
- 模型状态逻辑优化：未选择模型统一显示为红色状态